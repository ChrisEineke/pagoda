version: 1
templates:
  - id: shippable.jobs.yaml
    contents: |
     jobs:
     ###### Dev (Sandbox) Deploy and Manifest Jobs ########
     - name: {{ id }}-dev
       type: manifest
       flags:
       - "service: {{ id }}"
       - "version: dev"
       steps:
       - IN: trigger-dev-deploy
       - IN: {{ id }}-dev-image
       - IN: {{ id }}-options
     
     - name: {{ id }}-dev-deploy
       type: deploy
       flags:
       - "service: {{ id }}"
       - "env: dev"
       steps:
       - IN: zd-uw2-prime
       - IN: dev-parameters
       - IN: {{ id }}-dev
         force: true
       - IN: {{ id }}-dev-replicas
       - TASK: managed
         deployMethod: upgrade
     
     ####### Stag Deploy and Manifest Jobs ########
     - name: {{ id }}-stag
       type: manifest
       flags:
       - "service: {{ id }}"
       - "version: stag"
       steps:
       - IN: trigger-stag-deploy
       - IN: {{ id }}-stag-image
       - IN: {{ id }}-options
     
     - name: {{ id }}-stag-deploy
       type: deploy
       flags:
       - "service: {{ id }}"
       - "env: stag"
       steps:
       - IN: zs-uw2-prime
       - IN: stag-parameters
       - IN: {{ id }}-stag
         force: true
       - IN: {{ id }}-stag-replicas
       - TASK: managed
         deployMethod: upgrade
     
     ####### Prod Deploy and Manifest Jobs ########
     - name: {{ id }}-prod
       type: manifest
       flags:
       - "service: {{ id }}"
       - "version: prod"
       steps:
       - IN: trigger-prod-deploy
       - IN: {{ id }}-prod-image
       - IN: {{ id }}-options
     
     - name: {{ id }}-prod-deploy
       type: deploy
       flags:
       - "service: {{ id }}"
       - "env: prod"
       steps:
       - IN: zp-uw2-prime
       - IN: prod-parameters
       - IN: {{ id }}-prod
         force: true
       - IN: {{ id }}-prod-replicas
       - TASK: managed
         deployMethod: upgrade
     
     ####### Demo Deploy and Manifest Jobs ########
     - name: {{ id }}-demos-prime
       type: manifest
       flags:
       - "service: {{ id }}"
       - "version: demos"
       steps:
       - IN: trigger-demos-prime-deploy
       - IN: {{ id }}-demos-prime-image
       - IN: {{ id }}-options
     
     - name: {{ id }}-demos-prime-deploy
       type: deploy
       flags:
       - "service: {{ id }}"
       - "env: demos"
       steps:
       - IN: zo-uw2-prime
       - IN: demos-prime-parameters
       - IN: {{ id }}-demos-prime
         force: true
       - IN: {{ id }}-demos-prime-replicas
       - TASK: managed
         deployMethod: upgrade
     
          jobs:
          ###### Dev (Sandbox) Deploy and Manifest Jobs ########
          - name: {{ id }}-dev
            type: manifest
            flags:
            - "service: {{ id }}"
            - "version: dev"
            steps:
            - IN: trigger-dev-deploy
            - IN: {{ id }}-dev-image
            - IN: {{ id }}-options
            - IN: {{ id }}-options-dev-logs
          
          - name: {{ id }}-dev-deploy
            type: deploy
            flags:
            - "service: {{ id }}"
            - "env: dev"
            steps:
            - IN: zd-uw2-prime
            - IN: dev-parameters
            - IN: {{ id }}-dev
              force: true
            - IN: {{ id }}-dev-elb
              applyTo:
              - manifest: {{ id }}-dev
                image: {{ id }}-dev-image
                port: 80
            - IN: {{ id }}-dev-replicas
            - TASK: managed
              deployMethod: upgrade
          
          ####### Stag Deploy and Manifest Jobs ########
          - name: {{ id }}-stag
            type: manifest
            flags:
            - "service: {{ id }}"
            - "version: stag"
            steps:
            - IN: trigger-stag-deploy
            - IN: {{ id }}-stag-image
            - IN: {{ id }}-options
            - IN: {{ id }}-options-stag-logs
          
          - name: {{ id }}-stag-deploy
            type: deploy
            flags:
            - "service: {{ id }}"
            - "env: stag"
            steps:
            - IN: zs-uw2-prime
            - IN: stag-parameters
            - IN: {{ id }}-stag
              force: true
            - IN: {{ id }}-stag-elb
              applyTo:
              - manifest: {{ id }}-stag
                image: {{ id }}-stag-image
                port: 80
            - IN: {{ id }}-stag-replicas
            - TASK: managed
              deployMethod: upgrade
          
          ####### Prod Deploy and Manifest Jobs ########
          - name: {{ id }}-prod
            type: manifest
            flags:
            - "service: {{ id }}"
            - "version: prod"
            steps:
            - IN: trigger-prod-deploy
            - IN: {{ id }}-prod-image
            - IN: {{ id }}-options
            - IN: {{ id }}-options-prod-logs
          
          - name: {{ id }}-prod-deploy
            type: deploy
            flags:
            - "service: {{ id }}"
            - "env: prod"
            steps:
            - IN: zp-uw2-prime
            - IN: prod-parameters
            - IN: {{ id }}-prod
              force: true
            - IN: {{ id }}-prod-elb
              applyTo:
              - manifest: {{ id }}-prod
                image: {{ id }}-prod-image
                port: 80
            - IN: {{ id }}-prod-replicas
            - TASK: managed
              deployMethod: upgrade
          
          ####### Demo Deploy and Manifest Jobs ########
          - name: {{ id }}-demos-prime
            type: manifest
            flags:
            - "service: {{ id }}"
            - "version: demos"
            steps:
            - IN: trigger-demos-prime-deploy
            - IN: {{ id }}-demos-prime-image
            - IN: {{ id }}-options
            - IN: {{ id }}-options-demos-prime-logs
          
          - name: {{ id }}-demos-prime-deploy
            type: deploy
            flags:
            - "service: {{ id }}"
            - "env: demos"
            steps:
            - IN: zo-uw2-prime
            - IN: demos-prime-parameters
            - IN: {{ id }}-demos-prime
              force: true
            - IN: {{ id }}-demos-prime-replicas
            - TASK: managed
              deployMethod: upgrade
  - id: shippable.resources.yaml
    contents: |
     resources:
     ####### Docker options ########
     - name: {{ id }}-options
       type: dockerOptions
       version:
         portMappings:
         - ":8080"
         logConfig:
           type: awslogs
           options:
             awslogs-group: /zenreach/services/{{ id }}
             awslogs-region: us-west-2
     
     ####### Develop container resources ########
     - name: {{ id }}-dev-image
       type: image
       flags:
       - "service: {{ id }}"
       - "version: dev"
       integration: ZH-ECR
       pointer:
         sourceName: 577004102682.dkr.ecr.us-west-2.amazonaws.com/{{ id }}
       seed:
         versionName: dev
     
     - name: {{ id }}-dev-replicas
       type: replicas
       version:
         count: 1
     
     ####### Stag container resources ########
     - name: {{ id }}-stag-image
       type: image
       flags:
       - "service: {{ id }}"
       - "version: stag"
       integration: ZH-ECR
       pointer:
         sourceName: 577004102682.dkr.ecr.us-west-2.amazonaws.com/{{ id }}
       seed:
         versionName: stag
     
     - name: {{ id }}-stag-replicas
       type: replicas
       version:
         count: 2
     
     ####### Prod container resources ########
     - name: {{ id }}-prod-image
       type: image
       flags:
       - "service: {{ id }}"
       - "version: prod"
       integration: ZH-ECR
       pointer:
         sourceName: 577004102682.dkr.ecr.us-west-2.amazonaws.com/{{ id }}
       seed:
         versionName: prod
     
     - name: {{ id }}-prod-replicas
       type: replicas
       version:
         count: 8
     
     ####### Demo container resources ########
     - name: {{ id }}-demos-prime-image
       type: image
       flags:
       - "service: {{ id }}"
       - "version: demos"
       integration: ZH-ECR
       pointer:
         sourceName: 577004102682.dkr.ecr.us-west-2.amazonaws.com/{{ id }}
       seed:
         versionName: demos
     
     - name: {{ id }}-demos-prime-replicas
       type: replicas
       version:
         count: 0    
