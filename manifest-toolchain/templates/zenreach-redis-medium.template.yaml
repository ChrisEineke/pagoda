version: 1
template:
  author: zenreach
  provider: aws
  type: redis
  contents: |
    module "{{ id }}_redis" {
      source                     = "../../../modules/elasticache_redis"
      prefix                     = "${module.zenreach.prefix}"
      name                       = "{{ id }}"
      env                        = "${module.zenreach.env}"
      client_security_group_ids  = ["${data.terraform_remote_state.ecs.services_security_group_id}"]
      subnet_ids                 = ["${data.terraform_remote_state.net.elasticache_subnet_ids}"]
      management_security_groups = ["${data.terraform_remote_state.net.management_security_group_ids}"]
      num_cache_nodes            = 2
      node_type                  = "cache.m3.medium"
    }
    
    resource "aws_route53_record" "{id}_redis" {
      zone_id = "${data.terraform_remote_state.global.hosted_zone_id}"
      name    = "{{ id }}-redis.${module.zenreach.datacenter}.${data.terraform_remote_state.global.domain}"
      type    = "CNAME"
      ttl     = "300"
      records = ["${module.{{ id }}_redis.hostname}"]
    }
  comment: foobar
